<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Player — Coming Down</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <meta name="theme-color" content="#0f1013">

  <style>
    :root{
      --bg-0:#070708;
      --bg-1:#0f1114;
      --accent:#00bcd4;
      --accent-2:#0097a7;
      --muted:#9aa0a6;
      --glass: rgba(255,255,255,0.04);
      --glass-2: rgba(255,255,255,0.03);
      --card-radius:16px;
      --max-width:980px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:"Inter",system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
      background: 
        radial-gradient(circle at 20% 20%, rgba(0,188,212,0.08) 0%, transparent 40%),
        radial-gradient(circle at 80% 80%, rgba(0,151,167,0.05) 0%, transparent 40%),
        linear-gradient(135deg, var(--bg-0) 0%, var(--bg-1) 100%);
      color: #fff;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      overflow:hidden;
      position: relative;
      box-shadow: inset 0 0 200px rgba(0,0,0,0.3);
    }

    body::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(0,188,212,0.03) 0%, transparent 70%);
      animation: rotate 30s linear infinite;
      pointer-events: none;
      z-index: -1;
    }

    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    @keyframes pulse {
      0%, 100% { box-shadow: 0 8px 30px rgba(0,188,212,0.12); }
      50% { box-shadow: 0 8px 30px rgba(0,188,212,0.24); }
    }

    .particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -2;
      overflow: hidden;
    }

    .particle {
      position: absolute;
      bottom: 0;
      background: rgba(255,255,255,0.4);
      border-radius: 50%;
      animation: float 20s infinite linear;
    }

    @keyframes float {
      0% {
        transform: translateY(0) scale(1);
        opacity: 0;
      }
      10% {
        opacity: 1;
      }
      90% {
        opacity: 1;
      }
      100% {
        transform: translateY(-120vh) scale(0.8);
        opacity: 0;
      }
    }

    .btn:hover {
      animation: wiggle 0.4s;
    }

    @keyframes wiggle {
      0%, 100% { transform: translateY(-3px) rotate(0deg); }
      25% { transform: translateY(-3px) rotate(-2deg); }
      50% { transform: translateY(-3px) rotate(2deg); }
      75% { transform: translateY(-3px) rotate(-1deg); }
    }

    .card {
      animation: fadeInUp 0.8s ease-out;
    }

    .player {
      animation: fadeInUp 0.8s ease-out 0.3s both;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Layout */
    .app{
      position:relative;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:2rem;
    }
    .wrap{
      width:100%;
      max-width:var(--max-width);
      display:grid;
      grid-template-columns: 340px 1fr;
      gap:2rem;
      align-items:center;
      z-index:2;
    }

    /* Left - Album card */
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:var(--card-radius);
      padding:1.25rem;
      box-shadow: 0 8px 30px rgba(0,0,0,0.6), 0 0 20px rgba(0,188,212,0.1), inset 0 1px 0 rgba(255,255,255,0.02);
      border: 1px solid rgba(255,255,255,0.03);
      display:flex;
      flex-direction:column;
      gap:1rem;
      align-items:center;
      backdrop-filter: blur(6px) saturate(120%);
      transition: box-shadow 0.3s ease, transform 0.3s ease;
    }
    .card:hover {
      box-shadow: 0 12px 40px rgba(0,0,0,0.7), 0 0 30px rgba(0,188,212,0.2), inset 0 1px 0 rgba(255,255,255,0.02);
      transform: translateY(-5px);
    }
    .cover{
      width:100%;
      aspect-ratio:1/1;
      border-radius:12px;
      overflow:hidden;
      box-shadow: 0 10px 30px rgba(0,0,0,0.6), 0 6px 18px rgba(0,188,212,0.06);
      border: 1px solid rgba(255,255,255,0.03);
      transition: transform 0.3s ease;
    }
    .cover:hover {
      transform: scale(1.02);
    }
    .cover img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
      transform: translateZ(0);
      transition: transform 0.3s ease;
    }
    .cover:hover img {
      transform: scale(1.05) rotate(1deg);
    }
    .meta{
      width:100%;
      text-align:center;
    }
    .title{
      margin:0;
      font-weight:700;
      font-size:1.15rem;
      background: linear-gradient(45deg, var(--accent), var(--accent-2));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 0 20px rgba(0,188,212,0.3);
    }
    .artist{ margin:0; color:var(--muted); font-size:0.95rem; margin-top:.25rem;}
    .tags{ display:flex; gap:0.5rem; justify-content:center; margin-top:.6rem; flex-wrap:wrap;}
    .chip{
      font-size:0.75rem;
      padding:6px 10px;
      border-radius:999px;
      background:var(--glass-2);
      color:var(--muted);
      border:1px solid rgba(255,255,255,0.02);
    }

    /* Right - Controls */
    .player{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:var(--card-radius);
      padding:1.25rem 1.5rem;
      box-shadow: 0 8px 30px rgba(0,0,0,0.6), 0 0 20px rgba(0,188,212,0.1);
      border: 1px solid rgba(255,255,255,0.03);
      backdrop-filter: blur(6px) saturate(120%);
      transition: box-shadow 0.3s ease, transform 0.3s ease;
    }
    .player:hover {
      box-shadow: 0 12px 40px rgba(0,0,0,0.7), 0 0 30px rgba(0,188,212,0.2);
      transform: translateY(-5px);
    }
    .player-top{ display:flex; justify-content:space-between; align-items:center; gap:1rem; }
    .player-left{ display:flex; align-items:center; gap:1rem; }
    .now{
      display:flex; flex-direction:column;
    }
    .now .song{ font-weight:700; color:#fff; font-size:1.05rem; margin:0; }
    .now .album{ color:var(--muted); font-size:0.9rem; margin-top:.25rem; }

    /* Controls center */
    .visual-wrap{ position:relative; margin-top:1rem; height:160px; display:flex; align-items:center; justify-content:center; }
    canvas#visualizer{
      position:absolute; inset:0; width:100%; height:100%; border-radius:12px;
      box-shadow: inset 0 0 30px rgba(0,188,212,0.05);
    }
    .seekbar{
      width:100%;
      display:flex;
      gap:1rem;
      align-items:center;
      margin-top:1rem;
    }
    input[type="range"].seek{
      -webkit-appearance:none;
      appearance:none;
      height:6px;
      background:linear-gradient(90deg,#333,#222);
      border-radius:999px;
      flex:1;
      outline:none;
    }
    input[type="range"].seek::-webkit-slider-thumb{
      -webkit-appearance:none;
      width:14px;height:14px;border-radius:50%;
      background:var(--accent);
      box-shadow: 0 6px 20px rgba(0,151,167,0.18);
    }
    .time{ width:90px; text-align:right; color:var(--muted); font-size:0.85rem; }

    /* Controls row */
    .controls{
      display:flex; gap:1rem; align-items:center; justify-content:center; margin-top:1rem;
    }
    .btn{
      background:transparent;
      border:1px solid rgba(255,255,255,0.04);
      padding:10px 14px;
      border-radius:12px;
      color:#fff;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:.6rem;
      transition:all .16s ease;
      backdrop-filter: blur(6px);
    }
    .btn:hover{ transform:translateY(-3px); box-shadow: 0 10px 30px rgba(0,0,0,0.6); }
    .btn.primary{
      background: linear-gradient(90deg,var(--accent-2),var(--accent));
      border:none;
      color:#fff;
      padding:12px 18px;
      font-weight:600;
      box-shadow: 0 8px 30px rgba(0,188,212,0.12);
      animation: pulse 3s infinite;
    }
    .control-icon{ font-size:1.05rem; }

    .lower{
      display:flex; justify-content:space-between; align-items:center; gap:1rem; margin-top:1rem;
    }
    .sliders{ display:flex; gap:1rem; align-items:center; }
    .vslider{ width:140px;}
    input[type="range"].small{
      -webkit-appearance:none; appearance:none; height:6px; background:#222; border-radius:999px; outline:none;
    }
    input[type="range"].small::-webkit-slider-thumb{ -webkit-appearance:none; width:12px;height:12px;border-radius:50%; background:var(--accent); box-shadow:0 6px 18px rgba(0,151,167,0.12); }

    /* Footer tips */
    .tips{ color:var(--muted); font-size:0.85rem; margin-top:1rem; display:flex; gap:1rem; align-items:center; justify-content:flex-start; flex-wrap:wrap; }

    /* Responsive */
    @media (max-width:920px){
      .wrap{ grid-template-columns: 1fr; }
      .visual-wrap{ height:120px }
    }
    @media (max-width:520px){
      .app{ padding:1rem; }
      .cover{ border-radius:10px }
      .player{ padding:1rem }
      .visual-wrap{ height:100px }
    }

    /* small accessibility focus */
    .btn:focus, input[type="range"]:focus{ outline:2px solid rgba(0,188,212,0.12); outline-offset:3px; }
  </style>
</head>
<body>
  <div class="particles">
    <div class="particle" style="left: 5%; animation-delay: 0s; width: 2px; height: 2px;"></div>
    <div class="particle" style="left: 15%; animation-delay: 2s; width: 3px; height: 3px;"></div>
    <div class="particle" style="left: 25%; animation-delay: 4s; width: 1px; height: 1px;"></div>
    <div class="particle" style="left: 35%; animation-delay: 1s; width: 2px; height: 2px;"></div>
    <div class="particle" style="left: 45%; animation-delay: 3s; width: 4px; height: 4px;"></div>
    <div class="particle" style="left: 55%; animation-delay: 0.5s; width: 2px; height: 2px;"></div>
    <div class="particle" style="left: 65%; animation-delay: 2.5s; width: 3px; height: 3px;"></div>
    <div class="particle" style="left: 75%; animation-delay: 1.5s; width: 1px; height: 1px;"></div>
    <div class="particle" style="left: 85%; animation-delay: 3.5s; width: 2px; height: 2px;"></div>
    <div class="particle" style="left: 95%; animation-delay: 0.8s; width: 3px; height: 3px;"></div>
    <div class="particle" style="left: 10%; animation-delay: 1.2s; width: 2px; height: 2px;"></div>
    <div class="particle" style="left: 20%; animation-delay: 3.8s; width: 4px; height: 4px;"></div>
    <div class="particle" style="left: 30%; animation-delay: 0.3s; width: 1px; height: 1px;"></div>
    <div class="particle" style="left: 40%; animation-delay: 2.7s; width: 3px; height: 3px;"></div>
    <div class="particle" style="left: 50%; animation-delay: 4.1s; width: 2px; height: 2px;"></div>
    <div class="particle" style="left: 60%; animation-delay: 1.9s; width: 3px; height: 3px;"></div>
    <div class="particle" style="left: 70%; animation-delay: 0.6s; width: 1px; height: 1px;"></div>
    <div class="particle" style="left: 80%; animation-delay: 3.2s; width: 4px; height: 4px;"></div>
    <div class="particle" style="left: 90%; animation-delay: 2.1s; width: 2px; height: 2px;"></div>
    <div class="particle" style="left: 0%; animation-delay: 4.5s; width: 3px; height: 3px;"></div>
  </div>
  <div class="app" role="application" aria-label="Audio player">
    <div class="wrap">

      <!-- LEFT: ALBUM / ART -->
      <aside class="card" aria-label="Album information">
        <div class="cover" id="coverWrap">
          <img src="do.jpeg" alt="Album cover" id="coverImg">
        </div>
        <div class="meta">
          <h1 class="title" id="metaTitle">Coming Down</h1>
          <div class="artist" id="metaArtist">by The Weeknd</div>
          <div class="tags" aria-hidden="true">
            <div class="chip">Dark</div>
            <div class="chip">Visualizer</div>
            <div class="chip">PWA-ready</div>
          </div>
        </div>
      </aside>

      <!-- RIGHT: PLAYER CONTROLS -->
      <main class="player" id="player" role="main">
        <div class="player-top">
          <div class="player-left">
            <div class="now">
              <div class="song" id="nowSong">Coming Down</div>
              <div class="album" id="nowAlbum">ambatukam • 2025</div>
            </div>
          </div>

          <div class="player-actions" aria-hidden="true">
            <button class="btn" id="downloadBtn" title="Download (local file)">
              ⤓ Save
            </button>
            <button class="btn" id="shareBtn" title="Toggle dark accent">
              ✦ Accent
            </button>
          </div>
        </div>

        <div class="visual-wrap" aria-hidden="true">
          <canvas id="visualizer"></canvas>
        </div>

        <div class="seekbar" role="group" aria-label="Seek controls">
          <div style="min-width:60px">
            <button class="btn" id="back10" title="Back 10s">⟲ 10s</button>
          </div>

          <input type="range" id="seek" class="seek" min="0" value="0" step="0.01" aria-label="Seek" />
          <div class="time" id="time">00:00 / 00:00</div>
        </div>

        <div class="controls" role="toolbar" aria-label="Playback controls">
          <button class="btn" id="prevBtn" title="Previous">⟨⟨</button>

          <button class="btn primary" id="playPause" aria-pressed="false" title="Play / Pause">
            <span id="playIcon">▶</span>
            <span id="playText" style="margin-left:.4rem">Play</span>
          </button>

          <button class="btn" id="nextBtn" title="Next">⟩⟩</button>
        </div>

        <div class="lower" role="group" aria-label="Volume and playback options">
          <div class="sliders" style="align-items:center">
            <label for="volume" style="color:var(--muted); font-size:0.85rem;">Vol</label>
            <input id="volume" class="small vslider" type="range" min="0" max="1" step="0.01" value="0.80" aria-label="Volume">
          </div>

          <div style="display:flex; gap:0.75rem; align-items:center">
            <label for="speed" style="color:var(--muted); font-size:0.85rem;">Speed</label>
            <input id="speed" class="small" type="range" min="0.5" max="2" step="0.1" value="1" aria-label="Playback speed">
            <div style="color:var(--muted); min-width:48px; text-align:right" id="speedVal">1.0x</div>
          </div>
        </div>

        <div class="tips" aria-hidden="true">
          <div>Tip: Tekan <strong>Space</strong> untuk Play/Pause.</div>
          <div>Tip: Drag cover untuk ganti gambar (lokal).</div>
        </div>

      </main>
    </div>
  </div>

  <!-- audio element -->
  <audio id="audio" preload="metadata">
    <source src="coming-down.mp3" type="audio/mpeg">
    Browser tidak mendukung audio tag.
  </audio>

  <script>
  /* =========================
     Enhanced Player Script
     - better visualizer
     - accessibility + keyboard shortcuts
     - robust audio handling
     ========================= */

  const audio = document.getElementById('audio');
  const playPause = document.getElementById('playPause');
  const playIcon = document.getElementById('playIcon');
  const playText = document.getElementById('playText');
  const seek = document.getElementById('seek');
  const timeLabel = document.getElementById('time');
  const volume = document.getElementById('volume');
  const speed = document.getElementById('speed');
  const speedVal = document.getElementById('speedVal');
  const visual = document.getElementById('visualizer');
  const vctx = visual.getContext('2d');
  const back10 = document.getElementById('back10');

  // Responsive canvas sizing
  function resizeVis(){
    visual.width = visual.clientWidth * devicePixelRatio;
    visual.height = visual.clientHeight * devicePixelRatio;
    vctx.scale(devicePixelRatio, devicePixelRatio);
  }
  window.addEventListener('resize', resizeVis);
  resizeVis();

  // Format time (mm:ss)
  function fmt(sec){
    if (!isFinite(sec)) return '00:00';
    const m = Math.floor(sec/60).toString().padStart(2,'0');
    const s = Math.floor(sec%60).toString().padStart(2,'0');
    return `${m}:${s}`;
  }

  // --- AudioContext + Analyzer ---
  let audioCtx, analyser, sourceNode;
  function initAudioContext(){
    if (audioCtx) return;
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    analyser = audioCtx.createAnalyser();
    analyser.fftSize = 2048;
    analyser.smoothingTimeConstant = 0.85;
    sourceNode = audioCtx.createMediaElementSource(audio);
    sourceNode.connect(analyser);
    analyser.connect(audioCtx.destination);
  }

  // Visualizer draw
  function draw(){
    requestAnimationFrame(draw);
    if (!analyser) return;
    const bufferLength = analyser.frequencyBinCount;
    const data = new Uint8Array(bufferLength);
    analyser.getByteFrequencyData(data);

    // clear
    vctx.clearRect(0,0,visual.width,visual.height);
    // draw bars centered
    const width = visual.clientWidth;
    const height = visual.clientHeight;
    const barCount = Math.min(64, bufferLength);
    const gap = 4;
    const barWidth = (width - (barCount-1)*gap) / barCount;
    const centerY = height * 0.6;

    for (let i=0;i<barCount;i++){
      const v = data[Math.floor(i * (bufferLength / barCount))] / 255;
      const bh = Math.max(2, v * (height * 0.6));
      const x = i * (barWidth + gap);
      const grad = vctx.createLinearGradient(x, centerY-bh, x+barWidth, centerY+bh);
      grad.addColorStop(0, 'rgba(0,188,212,0.95)');
      grad.addColorStop(1, 'rgba(0,151,167,0.35)');
      vctx.fillStyle = grad;
      const y = centerY - bh;
      vctx.fillRect(x, y, barWidth, bh*2);
      // glow
      vctx.shadowBlur = 14 * v;
      vctx.shadowColor = 'rgba(0,188,212,0.14)';
    }
    vctx.shadowBlur = 0;
  }
  draw();

  // Update seek/time
  audio.addEventListener('loadedmetadata', ()=>{
    seek.max = audio.duration;
    timeLabel.textContent = `${fmt(0)} / ${fmt(audio.duration)}`;
  });

  audio.addEventListener('timeupdate', ()=>{
    if (!seek.dragging) seek.value = audio.currentTime;
    timeLabel.textContent = `${fmt(audio.currentTime)} / ${fmt(audio.duration)}`;
  });

  // Seek input interaction
  seek.addEventListener('input', ()=>{
    seek.dragging = true;
    timeLabel.textContent = `${fmt(seek.value)} / ${fmt(audio.duration)}`;
  });
  seek.addEventListener('change', ()=>{
    audio.currentTime = parseFloat(seek.value);
    seek.dragging = false;
  });

  // Play/pause
  async function togglePlay(){
    initAudioContext();
    if (audioCtx.state === 'suspended') await audioCtx.resume();
    if (audio.paused){
      await audio.play();
      playIcon.textContent = '⏸';
      playText.textContent = 'Pause';
      playPause.setAttribute('aria-pressed','true');
    } else {
      audio.pause();
      playIcon.textContent = '▶';
      playText.textContent = 'Play';
      playPause.setAttribute('aria-pressed','false');
    }
  }
  playPause.addEventListener('click', togglePlay);

  // Keyboard shortcuts
  window.addEventListener('keydown', (e)=>{
    if (e.code === 'Space' && e.target.tagName !== 'INPUT'){
      e.preventDefault();
      togglePlay();
    }
    if (e.key === 'ArrowRight'){ audio.currentTime = Math.min(audio.duration, audio.currentTime + 5); }
    if (e.key === 'ArrowLeft'){ audio.currentTime = Math.max(0, audio.currentTime - 5); }
    if (e.key === 'm'){ audio.muted = !audio.muted; }
  });

  // Volume & speed
  volume.addEventListener('input', ()=> audio.volume = parseFloat(volume.value));
  speed.addEventListener('input', ()=>{
    audio.playbackRate = parseFloat(speed.value);
    speedVal.textContent = parseFloat(speed.value).toFixed(1)+'x';
  });

  // Back 10s
  back10.addEventListener('click', ()=> { audio.currentTime = Math.max(0, audio.currentTime - 10); });

  // Visualizer connect on user interaction (some browsers require gesture)
  const unlock = () => {
    try { initAudioContext(); if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume(); }
    catch(e){/* ignore */}
    // remove after first interaction
    window.removeEventListener('click', unlock);
    window.removeEventListener('touchstart', unlock);
  };
  window.addEventListener('click', unlock);
  window.addEventListener('touchstart', unlock);

  // Resize visual canvas properly on load
  function fitCanvas(){
    visual.width = visual.clientWidth;
    visual.height = visual.clientHeight;
  }
  setTimeout(()=>{ resizeVis(); fitCanvas(); },200);

  // Simple accent toggle (for demo)
  const shareBtn = document.getElementById('shareBtn');
  shareBtn.addEventListener('click', ()=>{
    const el = document.documentElement;
    if (getComputedStyle(el).getPropertyValue('--accent') === '#e03e70'){
      el.style.setProperty('--accent','#6ce3b0');
      el.style.setProperty('--accent-2','#4ad19a');
    } else {
      el.style.setProperty('--accent','#e03e70');
      el.style.setProperty('--accent-2','#c41a5f');
    }
  });

  // Allow dragging cover image to replace locally (UX nicety)
  const coverImg = document.getElementById('coverImg');
  const coverWrap = document.getElementById('coverWrap');
  coverWrap.addEventListener('dragover', e=> e.preventDefault());
  coverWrap.addEventListener('drop', e=>{
    e.preventDefault();
    const f = e.dataTransfer.files?.[0];
    if (!f) return;
    const url = URL.createObjectURL(f);
    coverImg.src = url;
  });

  // Download button: if audio is local file, offer download; else fallback
  const downloadBtn = document.getElementById('downloadBtn');
  downloadBtn.addEventListener('click', ()=>{
    const src = audio.querySelector('source')?.src || audio.src;
    if (!src) return alert('No audio source available');
    const a = document.createElement('a');
    a.href = src;
    a.download = src.split('/').pop() || 'audio.mp3';
    document.body.appendChild(a);
    a.click();
    a.remove();
  });

  // Small safety: handle play errors
  audio.addEventListener('error', (ev)=>{
    console.error('Audio error', ev);
    alert('Gagal memuat audio. Pastikan file coming-down.mp3 ada di folder yang sama.');
  });

  // ensure animation draws only when analyser exists
  const waitAnalyser = setInterval(()=>{
    if (window.analyser || (typeof analyser !== 'undefined' && analyser)) {
      clearInterval(waitAnalyser);
    }
  }, 400);

  </script>
</body>
</html>
